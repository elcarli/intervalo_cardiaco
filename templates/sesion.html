<!Doctype html>
<html>
<head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.bundle.min.js"></script>
<script> 
	$(document).ready(function(){
	
	//Array con los RR del paciente actual
	var listaRR = [];
	var listaHR = [];
	var posX = 0;
	var posY = 1;

	//Se obtiene el contexto Canvas RR
	var ctx1 = document.getElementById('chartRR');
	var ctx2 = document.getElementById('chartHR');

	//Se inicializa el gráfico
	var scatterChartRR = new Chart(ctx1, {
		type: 'scatter',
		data: {
				datasets: [{
					label: 'RR',
					data: [],
					backgroundColor: 'rgba(255, 99, 132, 1)'
				}]
		},
		options: {
			"responsive": true,
			"maintainAspectRatio": false,
				scales: {
						xAxes: [{
								type: 'linear',
								position: 'bottom'
						}]
				}
		}
	});

	var lineChartHR = new Chart(ctx2, {
		type: 'line',
		data: {
				datasets: [{
					label: 'Heart Rate',
					data: [],
					backgroundColor: 'rgba(100, 250, 132, 0.3)'
				}]
		},
		options: {
			"responsive": true,
			"maintainAspectRatio": false,
				scales: {
						xAxes: [{
								type: 'linear',
								position: 'bottom'
						}]
				}
		}
	});
	
	function getSensor(){ 
		var nombre=document.getElementById("nombre").value;
		$.ajax({
                type: "GET",
                url: "/sesion?name="+nombre,
                success: function(data) {
						
                        var obj=data;

												listaRR.push(obj.rr);
												listaHR.push(obj.hr);

                }
            });
    }
    
	function graficar() {

		//Solo graficará cuando haya más de un elemento
		if (listaRR.length>1) {

			//Cordenadas de los puntos para graficar
			var parRR = {
				x: listaRR[posX],
				y: listaRR[posY]
			};

			var parHR = {
				x: posX,
				y: listaHR[posX]
			};

			posX++;
			posY++;

			//Se actualiza el grafico
			scatterChartRR.data.datasets[0].data.push(parRR);
			lineChartHR.data.datasets[0].data.push(parHR);

			scatterChartRR.update();
			lineChartHR.update();
		}

	}
    
  $('#empezar').click(function() {
		
		var intr = setInterval(function() {
			
			getSensor();

			graficar();
			
			$('#detener').click(function() {
				clearInterval(intr)
				});
			}, 500)
			
	});
    
});
</script
</head>
<body>
	<h2>{{tit}}</h2>
	<br><br>

	<p>Nombre: <input type="text" id="nombre"></p>
	<button id="empezar">Empezar</button>
	<br>
	<button id="detener">Detener</button>
	<br>
	
	<div>
    <canvas id="chartRR" width="200" height="200"></canvas>
  </div>

	<div>
    <canvas id="chartHR" width="200" height="200"></canvas>
  </div>

</body>
</html>
